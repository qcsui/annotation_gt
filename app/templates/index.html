{% extends 'base.html' %}

{% block content %}
<div style="width: 20%; float: left; height: 100%; overflow: auto;">
    <h2>Files</h2>
    <ul id="fileList">
        {% for file in files %}
            <li>
                <input type="checkbox" class="file-checkbox" id="check-{{ file }}" data-filename="{{ file }}">
                <label onclick="loadFile('{{ file }}')">{{ file }}</label>
            </li>
        {% endfor %}
    </ul>
    <button onclick="submitCheckedFiles()">Submit</button>
</div>
<div style="width: 40%; float: left; height: 100%;">
    <h2>Extracted Data</h2>
    <iframe id="htmlPreview" height="800"></iframe>
</div>
<div style="width: 40%; float: left; height: 100%;">
    <h2>PDF Preview</h2>
    <iframe id="pdfPreview" height="800"></iframe>
</div>
{% endblock %}

{% block scripts %}
<script>
function loadFile(filename){
    fetch('/load_file', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json'
        },
        body: JSON.stringify({filename: filename})
    })
    .then(response => response.json())
    .then(data => {
        document.getElementById('htmlPreview').src = data.html_path;
        document.getElementById('pdfPreview').src = data.pdf_path;
    })
    .catch(error => console.error('Error loading the file:', error));
}

function submitCheckedFiles() {
    const checkboxes = document.querySelectorAll('.file-checkbox');
    const checkedFiles = Array.from(checkboxes)
                              .filter(box => box.checked)
                              .map(box => box.getAttribute('data-filename'));

    fetch('/save_checked_files', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json'
        },
        body: JSON.stringify({files: checkedFiles})
    })
    .then(response => response.json())
    .then(data => {
        alert('Files saved: ' + data.saved);
    })
    .catch(error => console.error('Error saving files:', error));
}
</script>
{% endblock %}
